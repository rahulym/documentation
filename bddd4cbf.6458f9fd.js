(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{192:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(3),r=n(7),o=(n(0),n(247)),i={title:"Web Client",sidebar_label:"Web Client"},c={unversionedId:"platform_concepts/channelConfiguration/web",id:"platform_concepts/channelConfiguration/web",isDocsHomePage:!1,title:"Web Client",description:"Authenticate the Users in the Web Widget from the Parent Interface via Session Tokens",source:"@site/docs/platform_concepts/channelConfiguration/web.md",slug:"/platform_concepts/channelConfiguration/web",permalink:"/docs/platform_concepts/channelConfiguration/web",version:"current",sidebar_label:"Web Client",sidebar:"platform_concepts",previous:{title:"Launch your bot across channels!",permalink:"/docs/platform_concepts/channelConfiguration/overview"},next:{title:"Android Chatbot SDK",permalink:"/docs/platform_concepts/channelConfiguration/android"}},l=[],p={toc:l};function s(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"authenticate-the-users-in-the-web-widget-from-the-parent-interface-via-session-tokens"},"Authenticate the Users in the Web Widget from the Parent Interface via Session Tokens"),Object(o.b)("p",null,"Process:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"In the script of publish your bot, developer can configure to add session tokens."),Object(o.b)("li",{parentName:"ol"},"Based on the session tokens we will receive, we will do a parent interface auth API call."),Object(o.b)("li",{parentName:"ol"},"Based on the response from API, we can start the session with the same UID for user.")),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Place the following script at the end of your ",Object(o.b)("inlineCode",{parentName:"li"},"</body>")," tag")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'<script type="text/javascript">\nwindow.ymConfig = { bot:\u2019botId\u2019, ymAuthenticationToken: { id:"userPin",lang: "lang_code"} };  (function () {var w=window,ic=w.YellowMessenger;\nif("function"===typeof ic)ic("reattach_activator"),ic("update",ymConfig);else{var d=document,i=function()\n{i.c(arguments)};function l(){var e=d.createElement("script");e.type="text/javascript",e.async=!0,\ne.src="https://app.yellowmessenger.com/widget/main.js";var t=d.getElementsByTagName("script")[0];\nt.parentNode.insertBefore(e,t)}i.q=[],i.c=function(e){i.q.push(e)},w.YellowMessenger=i,\nw.attachEvent?w.attachEvent("onload",l):w.addEventListener("load",l,!1)}})();\n<\/script>\n')),Object(o.b)("p",null,"Don't forget to update the Bot ID and User PIN and Language Code in the given code."),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"Event name 'authenticate' will be received in the bot.")),Object(o.b)("p",null,"On receiving the event, we need to send back the senderId using the below code:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'app.sendEvent({\n               code: "verifiedUser",\n               data: senderId\n           });\n')),Object(o.b)("p",null,"Sample Code for reference:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),'if (app.data.event && app.data.event.code === \'authenticate\') {\n   /**check db for userpin => map the app.sender to the userpin\n    *next time when this event is received, check the userpin already has a sender in db,\n    *if yes => fetch the sender id and send it in the event\n    *else => send app.sender in the event */\n   const authenticate = async () => {\n       try {\n           let payloadData = app.data.event.payload\n     /**payload contains the details that were sent in the script using ymAuthenticationToken */\n           try {\n               payloadData = (typeof payloadData === "string") ? JSON.parse(payloadData) : payloadData;\n           } catch (e) { }\n           app.log(payloadData, "payloadData")\n \n           app.USER_PIN = (payloadData.id) ? payloadData.id : false;\n           // let default_language = payloadData.lang;\n           let pattern = /\\b(en|id)\\b/gi;\n           let default_language = (payloadData.lang && (payloadData.lang.match(pattern))) ? payloadData.lang.match(pattern)[0] : (payloadData.lang == "id_code") ? "id" : "en"\n           let query = {\n               "table": "user_pin_sender_id_mapping",\n               "body": {\n                   "query": {\n                       "match": {\n                           "user_pin": app.USER_PIN\n                       }\n                   }\n               }\n           }\n           const dbResult = await app.dataStore.search(query);\n           const dbRecords = app._.get(dbResult, \'hits.hits\', []);\n           let senderId;\n           if (dbRecords.length > 0) {\n               senderId = dbRecords[0]._source[\'sender_id\'];\n               let id = dbRecords[0]._id;\n               app.dataStore.update({\n                   table: \'user_pin_sender_id_mapping\',\n                   record: {\n                       _id: id,\n                       default_language\n                   }\n               }).then(() => {\n                   app.log("UPDATED");\n               }).catch(() => {\n                   app.log("NOT UPDATED");\n               })\n           } else {\n               // senderId = new Date().getTime();\n               senderId = app.USER_PIN;\n')))}s.isMDXComponent=!0},247:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return f}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=r.a.createContext({}),s=function(e){var t=r.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=s(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(n),b=a,f=d["".concat(i,".").concat(b)]||d[b]||u[b]||o;return n?r.a.createElement(f,c(c({ref:t},p),{},{components:n})):r.a.createElement(f,c({ref:t},p))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=b;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var p=2;p<o;p++)i[p]=n[p];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);